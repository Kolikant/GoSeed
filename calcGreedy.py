

import sys
import subprocess
import datetime
from timeit import default_timer as timer
import time
import socket
from os import listdir
from os.path import isfile, join

if len(sys.argv)!=1:
    print('useage: \"python3 runCalc.py\"')
    exit()

greedySlnDir = "/nfs_share/storage-simulations/Arielk/Greedy_extended/2021.01.29/parsedSols/"

def getWorkload(start, end):
    if end == "500" and start == "001":
        return '/nfs_share/storage-simulations/Roei/traces/UBC/B_heuristic_depth1_001_500.csv'
    start_end = start + "_" + end
    return '/nfs_share/storage-simulations/Roei/traces/divisions/ariel_runs/B_heuristic_depth1_001_500_' + start_end + '.csv'

def runStuff():
    solutions = [f for f in listdir(greedySlnDir) if ".csv" in f]

    # solutions = [
    #     'k10_001_200-051_075_T70_G10.csv',
    #     'k10_001_500-271_280_T70_G25.csv',
    #     'k11_001_500-151_175_T70_G40.csv',
    #     'k10_001_200-051_075_T70_G15.csv',
    #     'k10_001_500-271_280_T70_G30.csv',
    #     'k11_001_500-151_175_T70_G50.csv',
    #     'k10_001_200-051_075_T70_G20.csv',
    #     'k10_001_500-271_280_T70_G40.csv',
    #     'k11_001_500-151_175_T70_G5.csv',
    #     'k10_001_200-051_075_T70_G25.csv',
    #     'k10_001_500-271_280_T70_G50.csv',
    #     'k11_001_500-151_175_T70_G60.csv',
    #     'k10_001_200-051_075_T70_G30.csv',
    #     'k10_001_500-271_280_T70_G5.csv',
    #     'k11_001_500-151_175_T70_G70.csv',
    #     'k10_001_200-051_075_T70_G40.csv',
    #     'k10_001_500-271_280_T70_G60.csv',
    #     'k11_001_500-271_280_T70_G10.csv',
    #     'k10_001_200-051_075_T70_G50.csv',
    #     'k10_001_500-271_280_T70_G70.csv',
    #     'k11_001_500-271_280_T70_G15.csv',
    #     'k10_001_200-051_075_T70_G5.csv',
    #     'k10_001_500-351_400_T70_G10.csv',
    #     'k11_001_500-271_280_T70_G20.csv',
    #     'k10_001_200-051_075_T70_G60.csv',
    #     'k10_001_500-351_400_T70_G15.csv',
    #     'k11_001_500-271_280_T70_G25.csv',
    #     'k10_001_200-051_075_T70_G70.csv',
    #     'k10_001_500-351_400_T70_G20.csv',
    #     'k11_001_500-271_280_T70_G30.csv',
    #     'k10_001_500-001_200_T70_G10.csv',
    #     'k10_001_500-351_400_T70_G25.csv',
    #     'k11_001_500-271_280_T70_G40.csv',
    #     'k10_001_500-001_200_T70_G15.csv',
    #     'k10_001_500-351_400_T70_G30.csv',
    #     'k11_001_500-271_280_T70_G50.csv',
    #     'k10_001_500-001_200_T70_G20.csv',
    #     'k10_001_500-351_400_T70_G40.csv',
    #     'k11_001_500-271_280_T70_G5.csv',
    #     'k10_001_500-001_200_T70_G25.csv',
    #     'k10_001_500-351_400_T70_G50.csv',
    #     'k11_001_500-271_280_T70_G60.csv',
    #     'k10_001_500-001_200_T70_G30.csv',
    #     'k10_001_500-351_400_T70_G5.csv',
    #     'k11_001_500-271_280_T70_G70.csv',
    #     'k10_001_500-001_200_T70_G40.csv',
    #     'k10_001_500-351_400_T70_G60.csv',
    #     'k11_001_500-331_340_T70_G10.csv',
    #     'k10_001_500-001_200_T70_G50.csv',
    #     'k10_001_500-351_400_T70_G70.csv',
    #     'k11_001_500-331_340_T70_G15.csv',
    #     'k10_001_500-001_200_T70_G5.csv',
    #     'k11_001_500-001_200_T70_G10.csv',
    #     'k11_001_500-331_340_T70_G20.csv',
    #     'k10_001_500-001_200_T70_G60.csv',
    #     'k11_001_500-001_200_T70_G15.csv',
    #     'k11_001_500-331_340_T70_G25.csv',
    #     'k10_001_500-001_200_T70_G70.csv',
    #     'k11_001_500-001_200_T70_G20.csv',
    #     'k11_001_500-331_340_T70_G30.csv',
    #     'k10_001_500-051_075_T70_G10.csv',
    #     'k11_001_500-001_200_T70_G25.csv',
    #     'k11_001_500-331_340_T70_G40.csv',
    #     'k10_001_500-051_075_T70_G15.csv',
    #     'k11_001_500-001_200_T70_G30.csv',
    #     'k11_001_500-331_340_T70_G50.csv',
    #     'k10_001_500-051_075_T70_G20.csv',
    #     'k11_001_500-001_200_T70_G40.csv',
    #     'k11_001_500-331_340_T70_G5.csv',
    #     'k10_001_500-051_075_T70_G25.csv',
    #     'k11_001_500-001_200_T70_G50.csv',
    #     'k11_001_500-331_340_T70_G60.csv',
    #     'k10_001_500-051_075_T70_G30.csv',
    #     'k11_001_500-001_200_T70_G5.csv',
    #     'k11_001_500-331_340_T70_G70.csv',
    #     'k10_001_500-051_075_T70_G40.csv',
    #     'k11_001_500-001_200_T70_G60.csv',
    #     'k11_001_500-351_400_T70_G10.csv',
    #     'k10_001_500-051_075_T70_G50.csv',
    #     'k11_001_500-001_200_T70_G70.csv',
    #     'k11_001_500-351_400_T70_G15.csv',
    #     'k10_001_500-051_075_T70_G5.csv',
    #     'k11_001_500-001_500_T70_G5.csv',
    #     'k11_001_500-351_400_T70_G20.csv',
    #     'k10_001_500-051_075_T70_G60.csv',
    #     'k11_001_500-051_075_T70_G10.csv',
    #     'k11_001_500-351_400_T70_G25.csv',
    #     'k10_001_500-051_075_T70_G70.csv',
    #     'k11_001_500-051_075_T70_G15.csv',
    #     'k11_001_500-351_400_T70_G30.csv',
    #     'k10_001_500-061_070_T70_G10.csv',
    #     'k11_001_500-051_075_T70_G20.csv',
    #     'k11_001_500-351_400_T70_G40.csv',
    #     'k10_001_500-061_070_T70_G15.csv',
    #     'k11_001_500-051_075_T70_G25.csv',
    #     'k11_001_500-351_400_T70_G50.csv',
    #     'k10_001_500-061_070_T70_G20.csv',
    #     'k11_001_500-051_075_T70_G30.csv',
    #     'k11_001_500-351_400_T70_G5.csv',
    #     'k10_001_500-061_070_T70_G25.csv',
    #     'k11_001_500-051_075_T70_G40.csv',
    #     'k11_001_500-351_400_T70_G60.csv',
    #     'k10_001_500-061_070_T70_G30.csv',
    #     'k11_001_500-051_075_T70_G50.csv',
    #     'k11_001_500-351_400_T70_G70.csv',
    #     'k10_001_500-061_070_T70_G40.csv',
    #     'k11_001_500-051_075_T70_G5.csv',
    #     'k8_001_100-001_200_T70_G5.csv',
    #     'k10_001_500-061_070_T70_G50.csv',
    #     'k11_001_500-051_075_T70_G60.csv',
    #     'k8_001_100-001_500_T70_G5.csv',
    #     'k10_001_500-061_070_T70_G5.csv',
    #     'k11_001_500-051_075_T70_G70.csv',
    #     'k8_001_100-051_075_T70_G5.csv',
    #     'k10_001_500-061_070_T70_G60.csv',
    #     'k11_001_500-061_070_T70_G10.csv',
    #     'k8_001_100-061_070_T70_G5.csv',
    #     'k10_001_500-061_070_T70_G70.csv',
    #     'k11_001_500-061_070_T70_G15.csv',
    #     'k8_001_100-151_175_T70_G5.csv',
    #     'k10_001_500-151_175_T70_G10.csv',
    #     'k11_001_500-061_070_T70_G20.csv',
    #     'k8_001_100-271_280_T70_G5.csv',
    #     'k10_001_500-151_175_T70_G15.csv',
    #     'k11_001_500-061_070_T70_G25.csv',
    #     'k8_001_100-331_340_T70_G5.csv',
    #     'k10_001_500-151_175_T70_G20.csv',
    #     'k11_001_500-061_070_T70_G30.csv',
    #     'k8_001_100-351_400_T70_G5.csv',
    #     'k10_001_500-151_175_T70_G25.csv',
    #     'k11_001_500-061_070_T70_G40.csv',
    #     'k10_001_500-151_175_T70_G30.csv',
    #     'k11_001_500-061_070_T70_G50.csv',
    #     'k10_001_500-151_175_T70_G40.csv',
    #     'k11_001_500-061_070_T70_G5.csv',
    #     'k10_001_500-151_175_T70_G50.csv',
    #     'k11_001_500-061_070_T70_G60.csv',
    #     'k10_001_500-151_175_T70_G5.csv',
    #     'k11_001_500-061_070_T70_G70.csv',
    #     'k10_001_500-151_175_T70_G60.csv',
    #     'k11_001_500-151_175_T70_G10.csv',
    #     'k10_001_500-151_175_T70_G70.csv',
    #     'k11_001_500-151_175_T70_G15.csv',
    #     'k10_001_500-271_280_T70_G10.csv',
    #     'k11_001_500-151_175_T70_G20.csv',
    #     'k10_001_500-271_280_T70_G15.csv',
    #     'k11_001_500-151_175_T70_G25.csv',
    #     'k10_001_500-271_280_T70_G20.csv',
    #     'k11_001_500-151_175_T70_G30.csv'
    # ]

    for solution in solutions:
        sourceFiles = solution.split("-")[0].split("_")[1:]
        targetFiles = solution.split("-")[1].split("_")[0:2]
        sln = greedySlnDir + solution
        source = getWorkload(sourceFiles[0], sourceFiles[1])
        target = getWorkload(targetFiles[0], targetFiles[1])
        output = "./sols/" + solution


        command='./calc -source {0} -dest {1} -type SN -noOutput -sln {3} >> {2}'.format(source, target, output, sln)
        print(command)
        p = subprocess.Popen([command], shell=True)
        time_for_single_job = time.time()
        p.wait()
        time_for_single_job = time.time() - time_for_single_job

runStuff()




